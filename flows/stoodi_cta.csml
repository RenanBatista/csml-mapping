import {Dispatcher} from reducers

start:

  do global_user_position = {"step": "start", "flow": "stoodi_cta"}

  if (stoodi.user_cta) {
      goto flow stoodi_menu
  }
  else {
}

step_0:

say Dispatcher("SHOW_QUESTION", 
    {
        "question": {
          "prompt":  "Você já sabe que o Stoodi tem planos que vão te ajudar a entrar na Universidade?"  
      }, 
      "metadata": _metadata,
      "course_id": course_id,
      "airtable_key": global_airtable_key
    }, NULL
  )

  goto step step_1

step_1:

  hold

  do var_event = Dispatcher("USER_RESPONSE", 
      {
      "course": "stoodi", 
      "metadata": _metadata,
      "course_id": course_id,
      "airtable_key": global_airtable_key
      }, event
  )
  if (var_event.step && var_event.flow){
      do step_name = var_event.step
      do flow_name = var_event.flow
      goto $step_name@$flow_name
  }

  goto step step_3

step_3:

  say Dispatcher("SHOW_QUESTION", 
    {
        "question": {
          "prompt":  "Pois é, alguns dos benefícios que você tem com a gente são: \n\n✔️ Correção de redação \n✔️ Aulas ao vivo \n✔️ Mais de 6 mil vídeo aulas \n✔ Mais de 30 mil exercícios \n\nE muuuuito mais. "  
      }, 
      "metadata": _metadata,
      "course_id": course_id,
      "airtable_key": global_airtable_key
    }, NULL
  )

  say Wait(3000)

  goto step step_4

step_4:

  say Dispatcher("SHOW_QUESTION", 
    {
        "question": {
          "prompt":  "Somos feitos para estudantes fera como você 🦁"  
      }, 
      "metadata": _metadata,
      "course_id": course_id,
      "airtable_key": global_airtable_key
    }, NULL
  )

  say Wait(300)

  goto step step_5

step_5:

  say Dispatcher("SHOW_QUESTION", 
    {
        "question": {
          "prompt":  "https://www.stoodi.com.br/#boxplans \nDá só uma olhada"  
      }, 
      "metadata": _metadata,
      "course_id": course_id,
      "airtable_key": global_airtable_key
    }, NULL
  )

  say Wait(3000)

  goto step step_6

step_6:

  do stoodi.user_cta = true

  say Dispatcher("SHOW_QUESTION", 
    {
        "question": {
          "prompt":  "Que tal ver mais opções de aprendizado? 🤓"  
      }, 
      "metadata": _metadata,
      "course_id": course_id,
      "airtable_key": global_airtable_key
    }, NULL
  )

  goto step step_7

step_7:

  hold

  do var_event = Dispatcher("USER_RESPONSE", 
      {
      "course": "stoodi", 
      "metadata": _metadata,
      "course_id": course_id,
      "airtable_key": global_airtable_key
      }, event
  )
  if (var_event.step && var_event.flow){
      do step_name = var_event.step
      do flow_name = var_event.flow
      goto $step_name@$flow_name
  }

  do user_input = event.intent.name

  if (user_input match "Utilities.Reject"){
    //fluxo de finalização
    goto flow stoodi_menu
  } else {
    goto flow stoodi_menu
  }
